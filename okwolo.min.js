// okwolo@1.2.0
!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";var r=function(){var t=function(t){return void 0!==t},e=function(t){return null===t},n=function(t){return Array.isArray(t)},r=function(t){return"function"==typeof t},o=function(t){return"string"==typeof t},i=function(t){return!!t&&t.constructor===Object},a=function(t){return!!(t&&t.tagName&&t.nodeName&&t.ownerDocument&&t.removeAttribute)},u=function(){if("undefined"!=typeof window)return!0},c=function(e){if(t(e))return JSON.parse(JSON.stringify(e))},s=function(t,e){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var i=function(t){return"\n>>> "+String(JSON.stringify(t,function(t,e){return"function"==typeof e?e.toString():e},2)).replace(/\n/g,"\n    ")};if(!t)throw r.length>0&&(e+=r.map(i).join("")),new Error("@okwolo."+e)};return{deepCopy:c,assert:s,isDefined:t,isNull:e,isArray:n,isFunction:r,isString:o,isObject:i,isNode:a,isBrowser:u,makeQueue:function(){var e=[],n=function(){var n=e[0];t(n)&&n()};return{add:function(t){s(r(t),"utils.makeQueue.add : added objects must be a function",t),e.push(t),1===e.length&&n()},done:function(){e.shift(),n()}}},bus:function(e){var n={},a={},u=function(e,i){s(o(e),"utils.bus : handler type is not a string",e),s(r(i),"utils.bus : handler is not a function",i),t(n[e])||(n[e]=[]),n[e].push(i)},c=function(r){s(i(r),"utils.bus : event is not an object",r);var u=r.name;if(t(u)){if(s(o(u),"utils.bus : event name is not a string",u),t(a[u]))return;a[u]=!0}Object.keys(r).forEach(function(o){if(t(n[o]))return e?void e.add(function(){n[o].forEach(function(t){return t(r[o])}),e.done()}):void n[o].forEach(function(t){return t(r[o])})})};return Object.assign(c,{on:u})}}};t.exports=r},function(t,e,n){"use strict";var r=n(2);t.exports=r({modules:[n(3),n(4),n(5)],blobs:[n(6),n(7),n(10)],options:{kit:"standard",browser:!0,modules:{state:!0,history:!0,dom:!0,router:!0}}})},function(t,e,n){"use strict";var r=n(0)(),o=r.isFunction,i=r.isDefined,a=r.assert,u=r.deepCopy,c=r.isBrowser,s=r.bus,f=function(t){var e=t.modules,n=t.blobs,r=t.options,f=function(t,f){r.browser&&(i(f)||(a(c(),"app : must be run in a browser environment"),f=window));var d=s(),l=s(),p={emit:d,use:l};e.forEach(function(t){t({emit:d,use:l},f)}),n.forEach(function(t){l(t(f))});var h={},v=h;return d.on("state",function(t){v=t}),p.getState=function(){return a(v!==h,"getState : cannot get state before it has been set"),u(v)},r.modules.dom&&(p.update=function(){d({state:v})},i(t)&&l({target:t})),r.modules.state?(p.act=function(t,e){a("SET_STATE"===t||v!==h,"act : cannot act on state before it has been set"),d({act:{state:v,type:t,params:e}})},l({action:{type:"SET_STATE",target:[],handler:function(t,e){return e}}}),p.setState=function(t){if(o(t))return void p.act("SET_STATE",t(u(v)));p.act("SET_STATE",t)},r.modules.history&&(p.undo=function(){p.act("UNDO")},p.redo=function(){p.act("REDO")})):(a(!r.modules.history,"app : cannot use history blob without the state module",r),p.setState=function(t){if(o(t))return void d({state:t(u(v))});d({state:t})}),r.modules.router?(p.redirect=function(t,e){d({redirect:{path:t,params:e}})},p.show=function(t,e){d({show:{path:t,params:e}})},p.register=function(t,e){if(o(t))return void l({builder:t()});l({route:{path:t,callback:function(t){l({builder:e(t)})}}})}):p.register=function(t){l({builder:t()})},Object.assign(p.register,p)};return c()&&(f.kit=r.kit,i(window.okwolo)||(window.okwolo=f),window.okwolo[r.kit]=f),f};t.exports=f},function(t,e,n){"use strict";var r=n(0)(),o=r.assert,i=r.isDefined,a=r.isFunction,u=function(t,e){var n=t.emit,r=t.use,u=void 0,c=void 0,s=void 0,f=void 0,d=void 0,l=void 0,p=void 0,h=void 0,v=void 0,g=function(t){var e=h(t);return f&&(e=f(e)),e=s(e),d&&(e=d(e)),e},m=!1,b=!1,y=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!m;if(!b){if(!(i(p)&&i(h)&&i(v)))return;b=!0}if(!t)return void(l=c(p,g(v),l));l=u(p,g(v)),m=!0};n.on("state",function(t){o(i(t),"dom.updateState : new state is not defined",t),v=t,y()}),r.on("target",function(t){p=t,y(!0)}),r.on("builder",function(t){o(a(t),"dom.replaceBuilder : builder is not a function",t),h=t,y()}),r.on("draw",function(t){o(a(t),"dom.replaceDraw : new draw is not a function",t),u=t,y(!0)}),r.on("update",function(t){o(a(t),"dom.replaceUpdate : new target updater is not a function",t),c=t,y()}),r.on("build",function(t){o(a(t),"dom.replaceBuild : new build is not a function",t),s=t,y()}),r.on("prebuild",function(t){o(a(t),"dom.replacePrebuild : new prebuild is not a function",t),f=t,y()}),r.on("postbuild",function(t){o(a(t),"dom.replacePostbuild : new postbuild is not a function",t),d=t,y()})};t.exports=u},function(t,e,n){"use strict";var r=n(0)(),o=r.assert,i=r.deepCopy,a=r.makeQueue,u=r.isDefined,c=r.isArray,s=r.isFunction,f=r.isString,d=function(t){var e=t.emit,n=t.use,r={},d=[],l=[],p=a(),h=function(t,n,a){var d=i(t);o(u(r[n]),"state.execute : action type '"+n+"' was not found"),r[n].forEach(function(e){var r=e.target;s(r)&&(r=r(i(t),a),o(c(r),"state.execute : dynamic target of action "+n+" is not an array",r),r.forEach(function(t){o(f(t),"state.execute : dynamic target of action "+n+" is not an array of strings",r)}));var l=i(d);if(r.length>0){var p=d;r.forEach(function(t,i){if(o(u(l[t]),"state.execute : target of action "+n+" does not exist: @state."+r.slice(0,i+1).join(".")),i===r.length-1){var c=e.handler(l[t],a);o(u(c),"state.execute : result of action "+n+" on target @state"+r.join(".")+" is undefined"),p[t]=c}else l=l[t],p=p[t]})}else d=e.handler(l,a),o(u(d),"state.execute : result of action "+n+" on target @state is undefined")}),e({state:i(d)}),l.forEach(function(t){t(i(d),n,a)}),p.done()},v=function(t,e,n){var r=[function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;h(r,o,i)}];d.reverse().forEach(function(o,a){r[a+1]=function(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;t=u,e=c,n=s,o(r[a],i(u),c,s)}}),r[d.length](i(t),e,n)};e.on("act",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.state,n=t.type,r=t.params,i=void 0===r?{}:r;o(f(n),"state.act : action type is not a string",n),o(u(e),"state.act : cannot call action "+n+" on an undefined state",e),p.add(function(){v(e,n,i)})}),n.on("action",function(t){[].concat(t).forEach(function(t){var e=t.type,n=t.handler,i=t.target;o(f(e),"state.use.action : action's type is not a string",t,e),o(s(n),"state.use.action : handler for action "+e+" is not a function",t,n),c(i)?i.forEach(function(n){o(f(n),"state.use.action : target of action "+e+" is not an array of strings",t,i)}):o(s(i),"state.use.action : target of action "+e+" is not valid",i),void 0===r[e]?r[e]=[t]:r[e].push(t)})}),n.on("middleware",function(t){[].concat(t).forEach(function(t){o(s(t),"state.use.middleware : middleware is not a function",t),d.push(t)})}),n.on("watcher",function(t){[].concat(t).forEach(function(t){o(s(t),"state.use.watcher : watcher is not a function",t),l.push(t)})})};t.exports=d},function(t,e,n){"use strict";var r=n(0)(),o=r.assert,i=r.isString,a=r.isObject,u=r.isFunction,c=r.makeQueue,s=function(t,e){var n=t.emit,r=t.use,s=null!==e.document.origin&&"null"!==e.document.origin,f="",d=void 0,l=void 0,p=void 0,h=!1,v=c(),g=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];o(u(p),"router.fetch : fetch is not a function",p),p.apply(void 0,[d].concat(e))},m=function(t){return t.replace(new RegExp("^"+f),"")||""},b=e.location.pathname;s||(b=""),e.onpopstate=function(){b=m(e.location.pathname),g(b)},n.on("redirect",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.path,r=t.params,u=void 0===r?{}:r;o(i(n),"router.redirect : path is not a string",n),o(a(u),"router.redirect : params is not an object",u),v.add(function(){b=n,s?e.history.pushState({},"",(f+b).replace(/^\/C\:/,"")):console.log("@okwolo/router:: path changed to\n>>> "+b),g(b,u),v.done()})}),n.on("show",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.path,n=t.params,r=void 0===n?{}:n;o(i(e),"router.show : path is not a string",e),o(a(r),"router.show : params is not an object",r),v.add(function(){g(e,r),v.done()})}),r.on("route",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.path,n=t.callback;o(i(e),"router.use.route : path is not a string",e),o(u(n),"router.use.route : callback is not a function",e,n),o(u(l),"route.use.route : register is not a function",l),d=l(d,e,n),h||(h=!!g(b))}),r.on("base",function(t){o(i(t),"router.use.base : base url is not a string",t),f=t,b=m(b),g(b)}),r.on("register",function(t){o(u(t),"router.use.register : register is not a function",l),l=t}),r.on("fetch",function(t){o(u(t),"router.use.fetch : fetch is not a function",p),p=t})};t.exports=s},function(t,e,n){"use strict";function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var o=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=n(0)(),a=i.assert,u=i.isDefined,c=i.isNull,s=i.isArray,f=i.isString,d=i.isNode,l=i.isObject,p=i.isFunction,h=i.makeQueue,v=function(t){var e=function e(n){if(u(n.text))return n.DOM=t.document.createTextNode(n.text),n;var r=t.document.createElement(n.tagName);return Object.keys(n.attributes).forEach(function(t){r[t]=n.attributes[t]}),Object.keys(n.children).forEach(function(t){n.children[t]=e(n.children[t]),r.appendChild(n.children[t].DOM)}),n.DOM=r,n},n=function(t,e){return Object.keys(Object.assign({},t,e)).filter(function(n){var r=t[n],o=e[n];return!(r!==Object(r)&&o!==Object(o)&&r===o)})},i=function t(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return n.map(function(e){return f(e)?e:s(e)?t.apply(void 0,r(e)):l(e)?t(Object.keys(e).map(function(t){return e[t]&&t})):void 0}).filter(Boolean).join(" ")};return{name:"@okwolo/dom",draw:function(n,r){return a(d(n),"dom.draw : target is not a DOM node",n),u(r)||(r={text:""}),r=e(r),t.requestAnimationFrame(function(){n.innerHTML="",n.appendChild(r.DOM)}),r},update:function(r,o,i){a(d(r),"dom.update : target is not a DOM node",r);var c=h();t.requestAnimationFrame(function(){c.add(function(){s(i,o,{DOM:r,children:[i]},0),c.done()})});var s=function t(r,o,i,a){if(u(r)||u(o)){if(!u(r))return i.children[a]=e(o),void i.DOM.appendChild(i.children[a].DOM);if(!u(o))return i.DOM.removeChild(r.DOM),void c.add(function(){delete i.children[a],c.done()});if(r.tagName!==o.tagName){var s=r.DOM,f=e(o);return i.DOM.replaceChild(f.DOM,s),void(u(f.text)?(i.children[a].DOM=f.DOM,i.children[a].text=f.text,delete i.children[a].tagName,delete i.children[a].attributes,delete i.children[a].children):(i.children[a].DOM=f.DOM,delete i.children[a].text,i.children[a].tagName=f.tagName,i.children[a].attributes=f.attributes,i.children[a].children=f.children))}if(3===r.DOM.nodeType)r.text!==o.text&&(r.DOM.nodeValue=o.text,r.text=o.text);else{var d=n(r.attributes,o.attributes);0!==d.length&&d.forEach(function(t){r.attributes[t]=o.attributes[t],r.DOM[t]=o.attributes[t]})}var l=Object.keys(r.children||{}).concat(Object.keys(o.children||{})),p={};l.forEach(function(e){void 0===p[e]&&(p[e]=!0,t(r.children[e],o.children[e],r,e))})}};return i},build:function t(e){if(c(e))return{text:""};if(f(e))return{text:e};if(a(s(e),"dom.build : vdom object is not an array or string",e),p(e[0])){var n=e[1]||{};a(l(n),"dom.build : component's props is not an object",e,n);var r=e[2]||[];return a(s(r),"dom.build : component's children is not an array",e,r),t(e[0](Object.assign({},n,{children:r})))}var d=o(e,3),h=d[0],v=d[1],g=d[2];a(f(h),"dom.build : tag property is not a string",e,h);var m=/^ *(\w+) *(?:#([-\w\d]+))? *((?:\.[-\w\d]+)*)? *(?:\|\s*([^\s]{1}[^]*?))? *$/.exec(h);a(s(m),"dom.build : tag property cannot be parsed",h);var b=o(m,5),y=b[1],w=b[2],x=b[3],E=b[4];return null==v&&(v={}),a(l(v),"dom.build : attributes is not an object",e,v),u(w)&&!u(v.id)&&(v.id=w.trim()),(u(v.className)||u(x))&&(v.className=i(v.className,x).replace(/\./g," ").replace(/  +/g," ").trim()),u(E)&&(u(v.style)?(v.style+=";"+E,v.style=v.style.replace(/;;/g,";")):v.style=E),u(g)?a(s(g),"dom.build : children of vdom object is not an array",e,g):g=[],{tagName:y,attributes:v,children:g.map(t)}}}};t.exports=v},function(t,e,n){"use strict";var r=n(8),o=n(0)(),i=o.assert,a=o.isArray,u=function(t){return{name:"@okwolo/router",register:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments[1],n=arguments[2];return a(t)||(t=[]),t.push({pattern:r(e,[],{strict:!0}),callback:n}),t},fetch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(a(t),"router.fetch : store is not an array",t);var r=!1;return t.find(function(t){var o=t.pattern.exec(e);if(null!==o)return r=!0,o.shift(),t.pattern.keys.forEach(function(t,e){n[t.name]=o[e]}),t.callback(n),r}),r}}};t.exports=u},function(t,e,n){function r(t,e){for(var n,r=[],o=0,i=0,a="",u=e&&e.delimiter||"/";null!=(n=b.exec(t));){var f=n[0],d=n[1],l=n.index;if(a+=t.slice(i,l),i=l+f.length,d)a+=d[1];else{var p=t[i],h=n[2],v=n[3],g=n[4],m=n[5],y=n[6],w=n[7];a&&(r.push(a),a="");var x=null!=h&&null!=p&&p!==h,E="+"===y||"*"===y,O="?"===y||"*"===y,j=n[2]||u,k=g||m;r.push({name:v||o++,prefix:h||"",delimiter:j,optional:O,repeat:E,partial:x,asterisk:!!w,pattern:k?s(k):w?".*":"[^"+c(j)+"]+?"})}}return i<t.length&&(a+=t.substr(i)),a&&r.push(a),r}function o(t,e){return u(r(t,e))}function i(t){return encodeURI(t).replace(/[\/?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function a(t){return encodeURI(t).replace(/[?#]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function u(t){for(var e=new Array(t.length),n=0;n<t.length;n++)"object"==typeof t[n]&&(e[n]=new RegExp("^(?:"+t[n].pattern+")$"));return function(n,r){for(var o="",u=n||{},c=r||{},s=c.pretty?i:encodeURIComponent,f=0;f<t.length;f++){var d=t[f];if("string"!=typeof d){var l,p=u[d.name];if(null==p){if(d.optional){d.partial&&(o+=d.prefix);continue}throw new TypeError('Expected "'+d.name+'" to be defined')}if(m(p)){if(!d.repeat)throw new TypeError('Expected "'+d.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(d.optional)continue;throw new TypeError('Expected "'+d.name+'" to not be empty')}for(var h=0;h<p.length;h++){if(l=s(p[h]),!e[f].test(l))throw new TypeError('Expected all "'+d.name+'" to match "'+d.pattern+'", but received `'+JSON.stringify(l)+"`");o+=(0===h?d.prefix:d.delimiter)+l}}else{if(l=d.asterisk?a(p):s(p),!e[f].test(l))throw new TypeError('Expected "'+d.name+'" to match "'+d.pattern+'", but received "'+l+'"');o+=d.prefix+l}}else o+=d}return o}}function c(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function s(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function f(t,e){return t.keys=e,t}function d(t){return t.sensitive?"":"i"}function l(t,e){var n=t.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return f(t,e)}function p(t,e,n){for(var r=[],o=0;o<t.length;o++)r.push(g(t[o],e,n).source);return f(new RegExp("(?:"+r.join("|")+")",d(n)),e)}function h(t,e,n){return v(r(t,n),e,n)}function v(t,e,n){m(e)||(n=e||n,e=[]),n=n||{};for(var r=n.strict,o=!1!==n.end,i="",a=0;a<t.length;a++){var u=t[a];if("string"==typeof u)i+=c(u);else{var s=c(u.prefix),l="(?:"+u.pattern+")";e.push(u),u.repeat&&(l+="(?:"+s+l+")*"),l=u.optional?u.partial?s+"("+l+")?":"(?:"+s+"("+l+"))?":s+"("+l+")",i+=l}}var p=c(n.delimiter||"/"),h=i.slice(-p.length)===p;return r||(i=(h?i.slice(0,-p.length):i)+"(?:"+p+"(?=$))?"),i+=o?"$":r&&h?"":"(?="+p+"|$)",f(new RegExp("^"+i,d(n)),e)}function g(t,e,n){return m(e)||(n=e||n,e=[]),n=n||{},t instanceof RegExp?l(t,e):m(t)?p(t,e,n):h(t,e,n)}var m=n(9);t.exports=g,t.exports.parse=r,t.exports.compile=o,t.exports.tokensToFunction=u,t.exports.tokensToRegExp=v;var b=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g")},function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},function(t,e,n){"use strict";var r=n(0)(),o=r.deepCopy,i=function(){var t={},e=[],n=t,r=[];return{action:[{type:"UNDO",target:[],handler:function(){return e.length>0&&e[e.length-1]!==t?(r.push(n),e.pop()):n}},{type:"REDO",target:[],handler:function(){return r.length>0?(e.push(n),r.pop()):n}},{type:"__RESET__",target:[],handler:function(){return e=[],r=[],n}}],watcher:function(t,i){"__RESET__"!==i&&"*"!==i[0]&&("UNDO"!==i&&"REDO"!==i&&(r=[],e.push(n),e.length>21&&e.shift()),n=o(t))}}};t.exports=i}]);
